# This logstash parser is made specifically for Bro 2.3 logs.
# For best results, change the bro file rotation to 86400s (24h).
#
# Parser by Jose Ortiz
###############################################################################

filter {
  if [message] =~ /^#/ {
    drop {  }
  } else {
#app_stats ############################
  if [type] == "app_stats" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROAPPSTATS}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#app_stats ############################
#conn #################################
  if [type] == "conn" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROCONN}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#conn #################################
#communication ########################
  if [type] == "communication" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROCOMMUNICATION}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#communication ########################
#dhcp #################################
  if [type] == "dhcp" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BRODHCP}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#dhcp #################################
#dns ##################################
  if [type] == "dns" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BRODNS}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#dns ##################################
#dpd ##################################
  if [type] == "dpd" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BRODPD}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#dpd ##################################
#files ################################
  if [type] == "files" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROFILES}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#files ################################
#http #################################
  if [type] == "http" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROHTTP}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#http #################################
#certs ################################
  if [type] == "certs" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROKNOWNCERTS}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#certs ################################
#hosts ################################
  if [type] == "hosts" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROKNOWNHOSTS}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#hosts ################################
#services #############################
  if [type] == "services" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROKNOWNSERVICES}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#known_services #######################
#notice ###############################
  if [type] == "notice" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BRONOTICE}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#notice ###############################
#software #############################
  if [type] == "software" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROSOFTWARE}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#software #############################
#ssh ##################################
  if [type] == "ssh" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROSSH}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#ssh ##################################
#ssl ##################################
  if [type] == "ssl" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROSSL}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#ssl ##################################
#weird ################################
  if [type] == "weird" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROWEIRD}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#weird ################################
#x509##################################
  if [type] == "x509" {
    grok {
      patterns_dir => [ "/etc/logstash/patterns" ] 
      match => [ "message", "%{BROX509}" ]
      add_tag => [ "groked" ] 
    }
    date {
      locale => "en"
      timezone => "America/New_York"
      match => [ "ts", "UNIX" ]
      add_tag => [ "tsmatch" ]
    }
  }
#x509##################################
  }
}

